<!DOCTYPE html>
<html lang="en-GB">
<head>
    <title>Shiny on Google Cloud Run - Scale-to-Zero R Web Apps &middot; Mark Edmondson</title>
    <meta name="generator" content="Hugo 0.55.5" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Mark Edmondson">
    
      <meta name="description" content="How to create scale-to-zero Shiny apps on Google Cloud Run: pitfalls, how and why">
    
    
    <link rel="canonical" href="https://code.markedmondson.me/shiny-cloudrun/"/>
    <link rel="icon" href="https://code.markedmondson.me/favicon.ico">
    <link rel="apple-touch-icon" href="https://code.markedmondson.me/apple-touch-icon.png"/>
    <link rel="stylesheet" href="https://code.markedmondson.me/css/style.css">
    <link rel="stylesheet" href="https://code.markedmondson.me/css/github.css" rel="stylesheet" id="theme-stylesheet">
    <link rel="stylesheet" href="https://code.markedmondson.me/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.markedmondson.me/fancybox/jquery.fancybox.css">
    
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta property="og:title" content="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps" />
<meta property="og:description" content="How to create scale-to-zero Shiny apps on Google Cloud Run: pitfalls, how and why" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://code.markedmondson.me/shiny-cloudrun/" />
<meta property="article:published_time" content="2020-08-01T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2020-08-01T00:00:00&#43;00:00"/>

    
    
<meta itemprop="name" content="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps">
<meta itemprop="description" content="How to create scale-to-zero Shiny apps on Google Cloud Run: pitfalls, how and why">


<meta itemprop="datePublished" content="2020-08-01T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-08-01T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1753">



<meta itemprop="keywords" content="R,docker,cloud-run," />

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps"/>
<meta name="twitter:description" content="How to create scale-to-zero Shiny apps on Google Cloud Run: pitfalls, how and why"/>
<meta name="twitter:site" content="@HoloMarkeD"/>

    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://gtm2.markedmondson.me/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WFFMBH');</script>



    <script src="https://code.markedmondson.me/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<div class="container">


<div id="container">
	<header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="https://code.markedmondson.me/" id="logo">
          
          <i class="logo" style="background-image: url('https://code.markedmondson.me/images/greenhand.png')"></i>
          
          <span class="site-title">Mark Edmondson</span>
      </a>
      <nav id="main-nav">
          
          
          <a class="main-nav-link" href="https://code.markedmondson.me/">Home</a>
          
          
          
          
          
          

          
          <a class="main-nav-link" href="/r-packages/">My R Packages</a>
          

          
          
          
          
          <a class="main-nav-link" href="http://www.markedmondson.me/posts/">Non-code blog</a>
          
          
          
          <a class="main-nav-link" href="https://www.markedmondson.me/static/presentations/">Past Presentations</a>
          
          
      </nav>
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://code.markedmondson.me/images/gde_avatar.jpg"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
              <input type="search" name="q" class="search-form-input" placeholder="Search">
              <button type="submit" class="search-form-submit">
              </button>
              <input type="hidden" name="sitesearch" value="https://code.markedmondson.me/" />
         </form>
        </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tbody>
          <tr>
          
          
          <td><a class="main-nav-link" href="https://code.markedmondson.me/">Home</a></td>
          
          
          
          
          
          

          
          <td><a class="main-nav-link" href="/r-packages/">My R Packages</a></td>
          

          
          
          
          
          <td><a class="main-nav-link" href="http://www.markedmondson.me/posts/">Non-code blog</a></td>
          
          
          
          <td><a class="main-nav-link" href="https://www.markedmondson.me/static/presentations/">Past Presentations</a></td>
          
          
          <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
          <input type="search" name="q" class="search-form-input" placeholder="Search">
          <input type="hidden" name="sitesearch" value="https://code.markedmondson.me/" />
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</header>

   	
   	<div class="outer">
   	
    	<aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      
      <img id="avatar" src="https://code.markedmondson.me/images/gde_avatar.jpg">
      
      <h2 id="name">Mark Edmondson</h2>
      <h3 id="title">Coding in digital analytics</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Copenhagen, Denmark</span>
      
          <a id="follow" href="https://github.com/MarkEdmondson1234">
              Follow
          </a>
      
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        31
        <span>Posts</span>
      </div>
      <div class="article-info-block">
        
          17
        
        <span>
            Tags
        </span>
      </div>
    </div>
    <div class="profile-block social-links">
      <table>
        <tr>
          
<td><a href="//github.com/MarkEdmondson1234" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>























<td><a href="//youtube.com/MarkEdmondsonAtHome" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>















<td><a href="//linkedin.com/in/markpeteredmondson" target="_blank" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td>















<td><a href="//twitter.com/HoloMarkeD" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>


          <td><a href="https://code.markedmondson.me/index.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></td>
        </tr>
      </table>
    </div>
  </div>
</aside>

    

    <section id="main">
    
    <article id="page-undefined" class="article article-type-page" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
            <img src="https://code.markedmondson.me/banners/shiny-clouds.jpg" class="article-banner">
        

        <header class="article-header">
    <a href="https://code.markedmondson.me/shiny-cloudrun/">
    <h1 class="article-title" itemprop="name">
        Shiny on Google Cloud Run - Scale-to-Zero R Web Apps
    </h1>
    </a>
    <div class="article-meta">

        
        <div class="article-date">
            <i class="fa fa-calendar"></i>
            <time datetime="2020-08-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-08-01</time>
            &middot;
            1753
            words
            &middot;
            9
            minute read
        </div>
        
        

        
            
            
            <div class="article-category">
                <i class="fa fa-tags"></i>
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/r">R</a>
                &middot;
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/docker">docker</a>
                &middot;
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/cloud-run">cloud-run</a>
                
                
            </div>
            
        
    </div>
</header>

        <div class="article-entry" itemprop="articleBody">
            

<p>There are some references on how to deploy Shiny apps to Cloud Run around the web and in various bits of my package documentation, but its a cool service so I thought it worth pulling out and having a blog post to refer to.</p>

<h2 id="why-shiny-on-cloud-run">Why Shiny on Cloud Run?</h2>

<p>As mentioned in my <a href="https://code.markedmondson.me/r-at-scale-on-google-cloud-platform/">R at scale on Google Cloud Platform post</a>, Cloud Run is a container-as-a-service which lets you deploy Docker containers to the web without needing to worry about the infrastructure.  One of its most attractive features is the scaling, as you pay zero when your app has no visits, but as demand increases it can flexibly serve up your app to billions of users.</p>

<p>Its like Google Cloud Functions or AWS Lambda functions, but unlike those Cloud Run works with any language since its using a Docker container that can carry any language that supports HTTP. Cloud Functions only works with the supported languages, such as Python.</p>

<p>I favour Cloud Run over <a href="https://code.markedmondson.me/r-on-kubernetes-serverless-shiny-r-apis-and-scheduled-scripts/">Kubernetes clusters</a>, since its simpler to deploy and maintain apps, and you don&rsquo;t need to pay at least $100 a month for a Kubernetes cluster.</p>

<p>For <a href="https://www.rplumber.io/">R APIs such as plumber</a>, Cloud Run is my recommended solution, since it can scale so well and the cost is good.  However, for Shiny I have to date still used Kubernetes as Cloud Run had some limitations which in my experiments meant Shiny did not function.  This blog post is about how and why to work around those limitations.</p>

<h2 id="why-not-shiny-on-cloud-run">Why Not Shiny on Cloud Run</h2>

<p>The limitations that affect Shiny are around support for <a href="https://rstudio.github.io/websocket/articles/overview.html">websockets</a> and the fact that Shiny is a stateful service, whereas Cloud Run is meant for stateless services.</p>

<p>This means that for Cloud Run each HTTP request should not depend on previous HTTP requests, or is stateless. This is the case for an API, but Shiny is inherently a session based system: a user&rsquo;s past actions affect the current Shiny state. If a subsequent request to Shiny is directed to a different Shiny app than the one the user is in then we have problems.</p>

<p>As <a href="https://github.com/rstudio/shiny/issues/2455#issuecomment-497883381">RStudio&rsquo;s <code>jcheng5</code> put it</a>:</p>

<blockquote>
<p>Wait, is GCR akin to Amazon&rsquo;s Lambda? If so, I imagine this won&rsquo;t be a good fit for Shiny, no matter what software you put in the middle. These services are designed for stateless HTTP servers, and Shiny is inherently stateful. I bet you&rsquo;d end up with errors under load as requests that can only be served out of container A (where its session lives in memory) end up being routed to container B instead.</p>
</blockquote>

<p>As a newly launched service, for a long while Cloud Run did not support websockets.  That support is now enabled in some limited fashion, and so with a little configuration you can have a Shiny app running.</p>

<p>Thanks to <code>randy3k</code> the limitations above where navigated in the following ways:</p>

<ul>
<li>Limit the number of instances to 1 - this means there is only one instance to route requests too</li>
<li>Disable some websocket protocols to only leave those that work with Cloud Run - namely <code>disable_protocols websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling iframe-xhr-polling;</code></li>
</ul>

<p><a href="https://github.com/randy3k/shiny-cloudrun-demo">See <code>randy3k</code>&rsquo;s GitHub repo with a sample app solving the issues here</a>.</p>

<p>The above means that your Shiny app is limited: the number of concurrent requests you can have to one container in Cloud Run is 80 connections.  This means you lose the &ldquo;scale-to-a-billion&rdquo; feature, as on concurrent request 81 no container will be available to serve it.  It also means the app won&rsquo;t autoscale as the normal Cloud Run setups would - for normal applications, Cloud Run allows 1000 containers with up to 80 requests each e.g. 80,000 concurrent requests.</p>

<p>Having only one container means that you need to worry about the footprint of your Shiny app.  Whereas if autoscaling was available, high CPU/RAM load would trigger another container, as we will have only one container the max limit may be 80 but the real limit will be how much traffic your Shiny app can handle, which depends on how much CPU/RAM your Shiny app uses.  Also remember as R is single-threaded, all users will be waiting to use a single R process - see this <a href="https://appsilon.com/alternatives-to-scaling-shiny/">nice article by Appsilon for an overview on scaling shiny</a>.  This then is much like a traditional Shiny server running on say <a href="https://cloudyr.github.io/googleComputeEngineR/"><code>googleComputeEngineR</code></a>.</p>

<p>However, the above still leaves some use cases where Shiny on Cloud Run is useful:</p>

<ul>
<li>If your peak traffic is below 80 concurrent users e.g. 80 people browsing at the same time</li>
<li>And your app load on CPU/RAM is small enough to support your expected amount of concurrent users.</li>
</ul>

<p>For APIs the above limitations would be a problem as they can be queried thousands of times an hour, but since Shiny is usually a dashboard option for a select group of users, I think this leaves a lot of room for Shiny on Cloud Run being viable, plus you also get the killer feature of scaling to 0 in the downtime between user sessions, which gives it the advantage over other solutions such as running your own Shiny server.</p>

<p>Another big plus for me is that as its running on Google infrastructure, this means OAuth2 workflows are automatically on the accepted list of domains leading to setup for OAuth2 buttons using say <a href="https://code.markedmondson.me/googleAuthR/reference/googleAuth_js.html"><code>googleAuthR::googleAuth_js</code></a> as simpler and not needing to validate a domain.</p>

<p>If your Shiny app expects big peaks of traffic however, or is a big heavy app in terms of resources, then you are probably best looking at other options.  For me, this is keeping the existing <a href="https://code.markedmondson.me/r-on-kubernetes-serverless-shiny-r-apis-and-scheduled-scripts/">Shiny deployments running on Google Kubernetes Engine</a>.</p>

<h2 id="how-to-deploy-shiny-on-cloud-run">How to deploy Shiny on Cloud Run</h2>

<p>Cloud Run is such a useful service it is included in my newest package, <code>googleCloudRunner</code> as a <a href="https://code.markedmondson.me/googleCloudRunner/reference/cr_buildstep_run.html">build template</a> and <a href="https://code.markedmondson.me/googleCloudRunner/reference/cr_deploy_run.html">deployment option</a>.  To accomodate the limitations above, the latest version (on GitHub now but on CRAN soon as v0.3) includes parameters to enable Shiny on Cloud Run in CI/CD workflows e.g. if you supply your app and Dockerfile, it will build the Cloud Run container with your Shiny app embedded and deploy it for you.</p>

<p>You can set this up so it will trigger on each commit to git (say GitHub) so you can quickly make code changes and see it deployed on a URL.</p>

<h3 id="hello-world">Hello World</h3>

<p>The first example uses <a href="https://github.com/randy3k/shiny-cloudrun-demo"><code>randy3k</code>&rsquo;s example</a>.  You will need to clone the repo so that you have a local version of the Dockerfile and <code>app.R</code> containing the Shiny app.</p>

<p>Once you have the repo in say folder <code>shiny-app/</code> then you can build its Dockerfile and then deploy the app with one function:</p>

<pre><code class="language-r"># set up via googleCloudRunner::cr_setup() first if you haven't done so
library(googleCloudRunner)

# deploy the app version from this folder
cr_deploy_run(&quot;shiny-app/&quot;,
              remote = &quot;shiny-cloudrun&quot;,
              max_instances = 1, # required for shiny
              concurrency = 80)
</code></pre>

<h3 id="authenticated-shiny-app">Authenticated Shiny App</h3>

<p>This is the example deployed to <code>https://shiny-cloudrun-sc-ewjogewawq-ew.a.run.app/</code></p>

<p>This demonstrates deploying an app with a Google login, in this case for Search Console.</p>

<p>The difference here is to also add a <code>client.json</code> file to help with the authentication app, and setting up the Cloud Run domain as a verified OAuth2 source.  This is the example in the <a href="https://code.markedmondson.me/googleCloudRunner/articles/cloudrun.html#shiny-app-on-cloud-run-with-googleauthr-authentication-1">googleCloudRunner Cloud Run documentation</a></p>

<p>Folder:</p>

<pre><code>|
|- app.R
|- Dockerfile
|- client.json
|- shiny-customized.config
</code></pre>

<h4 id="app-r">app.R</h4>

<pre><code class="language-r">library(shiny)
library(searchConsoleR)
library(googleAuthR)

gar_set_client(web_json = &quot;client.json&quot;,
               scopes = &quot;https://www.googleapis.com/auth/webmasters&quot;)

ui &lt;- fluidPage(
  googleAuth_jsUI('auth', login_text = 'Login to Google'),
  tableOutput(&quot;sc_accounts&quot;)
)

server &lt;- function(input, output, session) {
  auth &lt;- callModule(googleAuth_js, &quot;auth&quot;)

  sc_accounts &lt;- reactive({
    req(auth())

    with_shiny(
      list_websites,
      shiny_access_token = auth()
    )

  })

  output$sc_accounts &lt;- renderTable({
    sc_accounts()
  })


}

shinyApp(ui = ui, server = server)
</code></pre>

<h4 id="dockerfile">Dockerfile</h4>

<pre><code>FROM rocker/shiny

# install R package dependencies
RUN apt-get update &amp;&amp; apt-get install -y \
    libcurl4-openssl-dev libssl-dev \
    ## clean up
    &amp;&amp; apt-get clean \
    &amp;&amp; rm -rf /var/lib/apt/lists/ \
    &amp;&amp; rm -rf /tmp/downloaded_packages/ /tmp/*.rds

## Install packages from CRAN
RUN install2.r --error \
    -r 'http://cran.rstudio.com' \
    googleAuthR searchConsoleR

COPY shiny-customized.config /etc/shiny-server/shiny-server.conf
COPY client.json /srv/shiny-server/client.json
COPY app.R /srv/shiny-server/app.R

EXPOSE 8080

USER shiny

# avoid s6 initialization
# see https://github.com/rocker-org/shiny/issues/79
CMD [&quot;/usr/bin/shiny-server&quot;]
</code></pre>

<h4 id="client-id-and-gcp-setup">client.id and GCP setup</h4>

<p>The client.json was a web client json from my project:</p>

<pre><code class="language-json">{&quot;web&quot;:{&quot;client_id&quot;:&quot;10XXX&quot;,&quot;project_id&quot;:&quot;XXXX&quot;,&quot;auth_uri&quot;:&quot;https://accounts.google.com/o/oauth2/auth&quot;,&quot;token_uri&quot;:&quot;https://accounts.google.com/o/oauth2/token&quot;,&quot;auth_provider_x509_cert_url&quot;:&quot;https://www.googleapis.com/oauth2/v1/certs&quot;,&quot;client_secret&quot;:&quot;XXXXX&quot;,&quot;redirect_uris&quot;:[&quot;http://localhost&quot;],&quot;javascript_origins&quot;:[&quot;https://www.example.com&quot;,&quot;http://localhost:1221&quot;]}}
</code></pre>

<p>You need to add the domain of where the Cloud Run is running in the JavaScript origins within the GCP console, that you get after deploying the app. (GCP console &gt; APIs &amp; Services &gt; Credentials &gt; Click on the Web Client ID you are using &gt; Add URL to Authorised JavaScript origins).</p>

<p><img src="/images/javascript-origins.png" alt="" /></p>

<p>In the example case this is <code>https://shiny-cloudrun-sc-ewjogewawq-ew.a.run.app/</code></p>

<p><em>It did take a while for this to propagate, so if your login doesn&rsquo;t work after this step try again in a few hours</em></p>

<h4 id="shiny-customized-config">shiny-customized.config</h4>

<p>This is the configuration file for Shiny that will overwrite the default one - its main purpose is turning off the websocket functionality that is not supported on Cloud Run</p>

<pre><code>disable_protocols websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling iframe-xhr-polling;

run_as shiny;

server {
  listen 8080;

  location / {
    site_dir /srv/shiny-server;

    log_dir /var/log/shiny-server;

    directory_index off;
  }
}
</code></pre>

<h4 id="deploying">Deploying</h4>

<p>You can then deploy similar to the example above, which will build the Dockerfile and then deploy it to Cloud Run.</p>

<pre><code class="language-r"># deploy the app version from this folder
cr_deploy_run(&quot;shiny_cloudrun/app/&quot;,
              remote = &quot;shiny-cloudrun-sc&quot;,
              max_instances = 1, # required for shiny
              concurrency = 80)
</code></pre>

<h2 id="summary">Summary</h2>

<p>Deploying Shiny to Cloud Run opens up a lot more experimentation with Shiny apps for me since they can be deployed for zero cost, and also gets around the authentication OAuth2 issues I was having on <code>shinyapps.io</code> since the authorization rules tightened.</p>

<p>If a Shiny app gets too popular for Cloud Run, then it may need migrating to another service but thats a nice problem to have and since its in a Docker container already thats a smooth switch (and there is another <a href="https://code.markedmondson.me/googleCloudRunner/articles/usecases.html#deploy-a-shiny-app-to-google-kubernetes-engine-1">googleCloudRunner example for deploying Shiny to Kuberentes</a>)</p>

<p>Coupled with the workflow to <a href="https://code.markedmondson.me/datascience-aas/">make paid Shiny apps</a> it paves the path to narrow focus but useful paid data science apps.</p>

<p>Many thanks to all the members of the R community who helped solve this problem - <code>rankdy3k</code> as mentioned above but also <code>maxheld83</code>, <code>jchen5</code> and <code>jdwrink</code> who first raised the <a href="https://github.com/rstudio/shiny/issues/2455">issue on the shiny GitHub</a>.</p>

<p>When researching this post I also found this <a href="https://medium.com/engineered-publicis-sapient/google-cloud-run-best-bet-to-host-shiny-application-3aa1e18770a9">guide on how to publish Shiny on Google Cloud Run by Vaibhav Agarwal</a> that uses the Web UI a bit more.</p>

<p>After first publishing Augusto also pointed me to his blog post about how to <a href="https://www.hasselpunk.com/blog/2020-06-13serverlessshinyengooglecloud/">deploy Shiny to Cloud Run for Anthos</a>[Spanish], that can run on top of your Kubernetes cluster.  This looks like a nicer more consistent way to deploy on Kubernetes.</p>

        </div>
        <footer class="article-footer">
    <a data-url="https://code.markedmondson.me/shiny-cloudrun/" data-id="487f6c86234d6d90b48b9cace989e42e" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
    </a>
    

    <script>
    (function ($) {
        
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
    </script>
</footer>

    </div>

    
<nav id="article-nav">
    
    <a href="https://code.markedmondson.me/datascience-aas/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Older
      </strong>
      <div class="article-nav-title">Online payments for data science apps (DSaaS) using R, Shiny, Firebase, Paddle and Google Cloud Functions</div>
    </a>
    

    
    <a href="https://code.markedmondson.me/gtm-serverside-cloudrun/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Newer
      </strong>
      <div class="article-nav-title">Google Tag Manager Server Side on Cloud Run - Pros and Cons</div>
    </a>
    
</nav>


</article>


<section id="comments">
    <div id="utterances_thread">
        <script src="https://utteranc.es/client.js"
    repo="MarkEdmondson1234/markedmondson.me-hugo"
    issue-term="pathname"
    label="comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
    </div>
</section>


    </section>

   	
    	<aside id="sidebar">
    
<div class="widget-wrap">
    <h3 class="widget-title">
        Recents
    </h3>
    <div class="widget">
        <ul id="recent-post">
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/writing-a-book/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/proto-book.png)" alt="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/writing-a-book/" class="title">Why and How I&#39;m writing a GA4 book called &#39;Learning Google Analytics&#39; for O&#39;Reilly</a></p>
                    <p class="item-date">
                        <time datetime="2021-10-23 11:04:50 &#43;0100 &#43;0100" itemprop="datePublished">2021-10-23</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/googleanalyticsr-100-release/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/GA4-090.png)" alt="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/googleanalyticsr-100-release/" class="title">googleAnalyticsR v1.0.0 - GA4 API, Automatic Shiny Dashboarding, Improved UI</a></p>
                    <p class="item-date">
                        <time datetime="2021-04-17 09:29:50 &#43;0100 &#43;0100" itemprop="datePublished">2021-04-17</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/edmondlytica/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/edmonlytica-shiny1.png)" alt="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/edmondlytica/" class="title">Creating your own cookieless analytics tool with GTM Server Side, Cloud Run, BigQuery and Shiny</a></p>
                    <p class="item-date">
                        <time datetime="2021-03-21 09:29:50 &#43;0100 CET" itemprop="datePublished">2021-03-21</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/data-privacy-gtm/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/hawks-and-doves.jpg)" alt="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/data-privacy-gtm/" class="title">Data Privacy Engineering with Google Tag Manager Server Side and Consent Mode</a></p>
                    <p class="item-date">
                        <time datetime="2020-11-27 09:29:50 &#43;0100 CET" itemprop="datePublished">2020-11-27</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/gtm-serverside-webhooks/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/gtm-serverside-events.png)" alt="Shiny on Google Cloud Run - Scale-to-Zero R Web Apps" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/gtm-serverside-webhooks/" class="title">Using Google Tag Manager Server Side to Trigger Webhook Events</a></p>
                    <p class="item-date">
                        <time datetime="2020-09-04 12:50:50 &#43;0100 &#43;0100" itemprop="datePublished">2020-09-04</time>
                    </p>
                </div>
            </li>
            
        </ul>
    </div>
</div>


    
<div class="widget-wrap">
    <h3 class="widget-title">
        Donate
    </h3>
    <div class="widget">
       	<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marked" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
       	<iframe src="https://github.com/sponsors/MarkEdmondson1234/button" title="Sponsor MarkEdmondson1234" height="35" width="116" style="border: 0;"></iframe>
    </div>
</div>


    
<div class="widget-wrap">
    <h3 class="widget-title">
        Get your GA4 history
    </h3>
    <script>
      function submitDL(value){
        dataLayer.push({'form_submit':value});
        document.getElementById('email').value = 'Submitted! See inbox'
      }
        
    </script>
    <div>
        <input type="email" name="email"  id="email"
          required 
          minlength="8"
          placeholder="you@email.com">
        <button 
          onclick="javascript:submitDL(document.getElementById('email').value);"
         >Send</button>
    </div>
</div>


    





    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tags
    </h3>
    <div class="widget">
        <ul class="category-list">
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/r">
                    R
                </a>
                <span class="category-list-count">22</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/big-query">
                    big-query
                </a>
                <span class="category-list-count">6</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/blogging">
                    blogging
                </a>
                <span class="category-list-count">3</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/cloud-functions">
                    cloud-functions
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/cloud-run">
                    cloud-run
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/docker">
                    docker
                </a>
                <span class="category-list-count">9</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/firebase">
                    firebase
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-analytics">
                    google-analytics
                </a>
                <span class="category-list-count">12</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-app-engine">
                    google-app-engine
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-auth">
                    google-auth
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-cloud-storage">
                    google-cloud-storage
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-compute-engine">
                    google-compute-engine
                </a>
                <span class="category-list-count">7</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-language">
                    google-language
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-tag-manager">
                    google-tag-manager
                </a>
                <span class="category-list-count">7</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/python">
                    python
                </a>
                <span class="category-list-count">5</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/rstudio-server">
                    rstudio-server
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/search-console">
                    search-console
                </a>
                <span class="category-list-count">3</span>
            </li>
            
        </ul>
    </div>
</div>




    


    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

    
	</div>
</div>

<footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021
      Powered by <a href="//gohugo.io">Hugo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>.
    </div>
  </div>
</footer>


<script src="https://code.markedmondson.me/fancybox/jquery.fancybox.pack.js"></script>
<script src="https://code.markedmondson.me/js/script.js"></script>
<script src="https://code.markedmondson.me/js/highlight.pack.js"></script>


<script>hljs.initHighlightingOnLoad();</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




</body>
</html>