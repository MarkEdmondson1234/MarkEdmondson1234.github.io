<!DOCTYPE html>
<html lang="en-GB">
<head>
    <title>SEO keyword research using searchConsoleR and googleAnalyticsR &middot; Mark Edmondson</title>
    <meta name="generator" content="Hugo 0.55.5" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Mark Edmondson">
    
      <meta name="description" content="The code bit of the blog">
    
    
    <link rel="canonical" href="https://code.markedmondson.me/search-console-google-analytics-r-keyword-research/"/>
    <link rel="icon" href="https://code.markedmondson.me/favicon.ico">
    <link rel="apple-touch-icon" href="https://code.markedmondson.me/apple-touch-icon.png"/>
    <link rel="stylesheet" href="https://code.markedmondson.me/css/style.css">
    <link rel="stylesheet" href="https://code.markedmondson.me/css/github.css" rel="stylesheet" id="theme-stylesheet">
    <link rel="stylesheet" href="https://code.markedmondson.me/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.markedmondson.me/fancybox/jquery.fancybox.css">
    
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta property="og:title" content="SEO keyword research using searchConsoleR and googleAnalyticsR" />
<meta property="og:description" content="In this blog we look at a method to estimate where to prioritise your SEO resources, estimating which keywords will give the greatest increase in revenue if you could improve their Google rank.
Overview Thanks to Vincent at data-seo.com who proof read and corrected some errors in the first draft
Data comes from Google Search Console and Google Analytics.
Search Console is used to provide the keywords in these days post (not provided)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://code.markedmondson.me/search-console-google-analytics-r-keyword-research/" />
<meta property="article:published_time" content="2016-06-21T23:03:57&#43;01:00"/>
<meta property="article:modified_time" content="2016-06-21T23:03:57&#43;01:00"/>

    
    
<meta itemprop="name" content="SEO keyword research using searchConsoleR and googleAnalyticsR">
<meta itemprop="description" content="In this blog we look at a method to estimate where to prioritise your SEO resources, estimating which keywords will give the greatest increase in revenue if you could improve their Google rank.
Overview Thanks to Vincent at data-seo.com who proof read and corrected some errors in the first draft
Data comes from Google Search Console and Google Analytics.
Search Console is used to provide the keywords in these days post (not provided).">


<meta itemprop="datePublished" content="2016-06-21T23:03:57&#43;01:00" />
<meta itemprop="dateModified" content="2016-06-21T23:03:57&#43;01:00" />
<meta itemprop="wordCount" content="1657">



<meta itemprop="keywords" content="R,google-analytics,search-console," />

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SEO keyword research using searchConsoleR and googleAnalyticsR"/>
<meta name="twitter:description" content="In this blog we look at a method to estimate where to prioritise your SEO resources, estimating which keywords will give the greatest increase in revenue if you could improve their Google rank.
Overview Thanks to Vincent at data-seo.com who proof read and corrected some errors in the first draft
Data comes from Google Search Console and Google Analytics.
Search Console is used to provide the keywords in these days post (not provided)."/>
<meta name="twitter:site" content="@HoloMarkeD"/>

    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//gtm2.markedmondson.me/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WFFMBH');</script>



    <script src="https://code.markedmondson.me/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<div class="container">


<div id="container">
	<header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="https://code.markedmondson.me/" id="logo">
          
          <i class="logo" style="background-image: url('https://code.markedmondson.me/images/greenhand.png')"></i>
          
          <span class="site-title">Mark Edmondson</span>
      </a>
      <nav id="main-nav">
          
          
          <a class="main-nav-link" href="https://code.markedmondson.me/">Home</a>
          
          
          
          
          
          

          
          <a class="main-nav-link" href="/r-packages/">My R Packages</a>
          

          
          
          
          
          <a class="main-nav-link" href="http://www.markedmondson.me/posts/">Non-code blog</a>
          
          
          
          <a class="main-nav-link" href="https://www.markedmondson.me/static/presentations/">Past Presentations</a>
          
          
      </nav>
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://code.markedmondson.me/images/gde_avatar.jpg"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
              <input type="search" name="q" class="search-form-input" placeholder="Search">
              <button type="submit" class="search-form-submit">
              </button>
              <input type="hidden" name="sitesearch" value="https://code.markedmondson.me/" />
         </form>
        </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tbody>
          <tr>
          
          
          <td><a class="main-nav-link" href="https://code.markedmondson.me/">Home</a></td>
          
          
          
          
          
          

          
          <td><a class="main-nav-link" href="/r-packages/">My R Packages</a></td>
          

          
          
          
          
          <td><a class="main-nav-link" href="http://www.markedmondson.me/posts/">Non-code blog</a></td>
          
          
          
          <td><a class="main-nav-link" href="https://www.markedmondson.me/static/presentations/">Past Presentations</a></td>
          
          
          <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
          <input type="search" name="q" class="search-form-input" placeholder="Search">
          <input type="hidden" name="sitesearch" value="https://code.markedmondson.me/" />
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</header>

   	
   	<div class="outer">
   	
    	<aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      
      <img id="avatar" src="https://code.markedmondson.me/images/gde_avatar.jpg">
      
      <h2 id="name">Mark Edmondson</h2>
      <h3 id="title">Coding in digital analytics</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Copenhagen, Denmark</span>
      
          <a id="follow" href="https://github.com/MarkEdmondson1234">
              Follow
          </a>
      
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        29
        <span>Posts</span>
      </div>
      <div class="article-info-block">
        
          17
        
        <span>
            Tags
        </span>
      </div>
    </div>
    <div class="profile-block social-links">
      <table>
        <tr>
          
<td><a href="//github.com/MarkEdmondson1234" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>























<td><a href="//youtube.com/MarkEdmondsonAtHome" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>















<td><a href="//linkedin.com/in/markpeteredmondson" target="_blank" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td>















<td><a href="//twitter.com/HoloMarkeD" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>


          <td><a href="https://code.markedmondson.me/index.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></td>
        </tr>
      </table>
    </div>
  </div>
</aside>

    

    <section id="main">
    
    <article id="page-undefined" class="article article-type-page" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
            <img src="https://code.markedmondson.me/banners/searchConsole.png" class="article-banner">
        

        <header class="article-header">
    <a href="https://code.markedmondson.me/search-console-google-analytics-r-keyword-research/">
    <h1 class="article-title" itemprop="name">
        SEO keyword research using searchConsoleR and googleAnalyticsR
    </h1>
    </a>
    <div class="article-meta">

        
        <div class="article-date">
            <i class="fa fa-calendar"></i>
            <time datetime="2016-06-21 23:03:57 &#43;0100 &#43;0100" itemprop="datePublished">2016-06-21</time>
            &middot;
            1657
            words
            &middot;
            8
            minute read
        </div>
        
        

        
            
            
            <div class="article-category">
                <i class="fa fa-tags"></i>
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/r">R</a>
                &middot;
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/google-analytics">google-analytics</a>
                &middot;
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/search-console">search-console</a>
                
                
            </div>
            
        
    </div>
</header>

        <div class="article-entry" itemprop="articleBody">
            

<p>In this blog we look at a method to estimate where to prioritise your SEO resources, estimating which keywords will give the greatest increase in revenue if you could improve their Google rank.</p>

<h2 id="overview">Overview</h2>

<p><em>Thanks to <a href="https://data-seo.com/">Vincent at data-seo.com</a> who proof read and corrected some errors in the first draft</em></p>

<p>Data comes from <a href="https://www.google.com/webmasters/tools/home">Google Search Console</a> and <a href="https://www.google.com/webmasters/tools/home?hl=en">Google Analytics</a>.</p>

<p>Search Console is used to provide the keywords in these days post <a href="http://www.notprovidedcount.com/">(not provided)</a>.  We then link the two data sets by using the URLs as a key, and estimate how much each keyword made in revenue by splitting them in the same proportion as the traffic they have sent to the page.</p>

<p>This approach assumes each keyword converts at the same rate once on the page, and will work better with some websites more than others - the best results I have seen are those websites with a lot of content on seperate URLs, such that they capture long-tail queries.  This is because the amount of keywords per URL is small, but with enough volume to make the estimates trustworthy.</p>

<p>We also try to incorporate magins of error in the results.  This avoids situations where one click on position 40 gets a massive weighting in potential revenue, which in reality could have been a freak event.</p>

<h2 id="summary">Summary</h2>

<p>The method produced a targeted keyword list of 226 from an original seed list of ~21,000.  The top 30 revenue targets are shown in the plot below:</p>

<p><img src="/images/see-potential.png" alt="seo-forecast-estimate" /></p>

<p>Read below on how the plot was generated and what the figures mean.</p>

<h2 id="getting-the-data">Getting the data</h2>

<p>Google Analytics recently provided more integration between the Search Console imports and the web session data, of which <a href="http://online-behavior.com/analytics/search-console">Daniel Waisberg has an excellent walk-through</a>, which could mean you can skip the first part of this script.</p>

<p>However, there are circumstances where the integration won&rsquo;t work, such as when the URLs in Google Analytics are a different format to Search Console - with the below script you have control on how to link the URLs, by formatting them to look the same.</p>

<p>Data is provided via my <a href="https://cran.r-project.org/web/packages/searchConsoleR/index.html">searchConsoleR</a> and <a href="http://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a> R packages.</p>

<pre><code class="language-r">library(searchConsoleR)
library(googleAnalyticsR)

## authentication with both GA and SC
options(googleAuthR.scopes.selected = 
  c(&quot;https://www.googleapis.com/auth/webmasters&quot;,
    &quot;https://www.googleapis.com/auth/analytics&quot;,
    &quot;https://www.googleapis.com/auth/analytics.readonly&quot;))
    
googleAuthR::gar_auth()

## replace with your GA ID
ga_id &lt;- 1111111 

## date range to fetch
start &lt;- as.character(Sys.Date() - 93)
end &lt;- &quot;2016-06-01&quot;

## Using new GA v4 API
## GAv4 filters
google_seo &lt;- 
  filter_clause_ga4(list(dim_filter(&quot;medium&quot;, 
                                     &quot;EXACT&quot;, 
                                     &quot;organic&quot;),
                          dim_filter(&quot;source&quot;, 
                                     &quot;EXACT&quot;, 
                                     &quot;google&quot;)),
                     operator = &quot;AND&quot;)

## Getting the GA data
gadata &lt;-
  google_analytics_4(ga_id,
                     date_range = c(start,end),
                     metrics = c(&quot;sessions&quot;,
                                 &quot;transactions&quot;,
                                 &quot;transactionRevenue&quot;),
                     dimensions = c(&quot;landingPagePath&quot;),
                     dim_filters = google_seo,
                     order = order_type(&quot;transactions&quot;, 
                                        sort_order = &quot;DESC&quot;, 
                                        orderType = &quot;VALUE&quot;),
                     max = 20000)

## Getting the Search Console data
## The development version &gt;0.2.0.9000 lets you get more than 5000 rows
scdata &lt;- search_analytics(&quot;http://www.example.co.uk&quot;, 
                           startDate = start, endDate = end,
                           dimensions = c(&quot;page&quot;,&quot;query&quot;),
                           rowLimit = 20000)

</code></pre>

<h2 id="transforming-the-data">Transforming the data</h2>

<p>First we change the Search Console URLs into the same format as Google Analytics.  In this example, the hostname is appended to the GA URLs already (a reason why the native support won&rsquo;t work), but you may also need to append the hostname to the GA URLs via <code>paste0(&quot;www.yourdomain.com&quot;, gadata$page)</code>.</p>

<p>We also get the search page result (e.g. Page 1 = 1-10, Page 2 = 11-20) as it may be useful.</p>

<p>For the split of revenue later, the last call calculates the % of clicks going to each URL.</p>

<h3 id="search-console-data-transformation">Search Console data transformation</h3>

<pre><code class="language-r">library(dplyr)

## get urls in same format

## this will differ from website to website, 
## but in most cases you will need to add the domain to the GA urls:
## gadata$page &lt;- paste0(&quot;www.yourdomain.com&quot;, gadata$landingPagePath)
## gadata has urls www.example.com/pagePath
## scdata has urls in http://www.example.com/pagePath
scdata$page2 &lt;- gsub(&quot;http://&quot;,&quot;&quot;, scdata$page)

## get SERP
scdata$serp &lt;- cut(scdata$position, 
                   breaks = seq(1, 100, 10), 
                   labels = as.character(1:9),
                   include.lowest = TRUE, 
                   ordered_result = TRUE)

## % of SEO traffic to each page per keyword
scdata &lt;- scdata %&gt;% 
  group_by(page2) %&gt;% 
  mutate(clickP = clicks / sum(clicks)) %&gt;%
  ungroup()

</code></pre>

<h3 id="merging-with-google-analytics">Merging with Google Analytics</h3>

<p>Now we merge the data, and calculate the estimates of revenue, transactions and sessions.</p>

<p>Why estimate sessions when we already have them?  This is how we assess how accurate this approach is - if the clicks is roughly the same as the estimated sessions, we can go further.</p>

<p>The accuracy metric is assessed as the ratio between the estiamted sessions and the clicks, minus 1.  This will be 0 when 100% accuracy, and then the further away from 0 the figure is the less we trust the results.</p>

<p>We also round the avergae position to the nearest whole number.</p>

<pre><code class="language-r">library(dplyr)

## join data on page
joined_data &lt;- gadata %&gt;% 
  left_join(scdata, by = c(landingPagePath = &quot;page2&quot;)) %&gt;%
  mutate(transactionsEst = clickP*transactions,
         revenueEst = clickP*transactionRevenue,
         sessionEst = clickP*sessions,
         accuracyEst = ((sessionEst / clicks) - 1),
         positionRound = round(position))

## we only want clicks over 0, and get rid of a few columns.
tidy_data &lt;- joined_data %&gt;% 
  filter(clicks &gt; 0) %&gt;% 
  select(-page, -sessions, -transactions, -transactionRevenue) 

</code></pre>

<h3 id="is-it-reliable">Is it reliable?</h3>

<p>A histogram of the accuracy estimate shows we consistently over estimate but the clicks and estimated sessions are within a magnitude:</p>

<p><img src="/images/histogram1.png" alt="keyword-sessio-click-estimate-histogram" /></p>

<p>Most of the session estimates were intrestingly around 1.3 times more than the clicks.  This may be because Search Console clicks act more like Google SEO users, but any other ideas please say in comments!</p>

<p>From above I discarded all rows with an accuracy &gt; 10 as unreliable, although you may want to be stricter in your criteria.  All figures are to be taken with a pinch of salt with this many assumptions, but if the relative performance looked ok then I feel there is still enough to get some action from the data.</p>

<h2 id="creating-the-seo-forecasts">Creating the SEO forecasts</h2>

<p>We now use the data to create a click curve table, with estimates on the CTR for each position, and the confidence in those results.</p>

<p>I first attempted some models on making predictions of click curves for a website, but didn&rsquo;t find any general satisifactory regressions.</p>

<p>The diagram below uses a weighted <code>loess</code> within <code>ggplot2</code> which is good to show trend but not for making predictions.</p>

<p><img src="/images/ctr_scatter.png" alt="ctr-scatter-plot" /></p>

<h3 id="a-click-curve-to-use">A click curve to use</h3>

<p>However, 99% of the time we will only be concerned with the top 10, so it wasn&rsquo;t too taxing to calculate the click through rates per website based on the data they had:</p>

<pre><code class="language-r">library(dplyr)

click_curve &lt;- tidy_data %&gt;% 
  group_by(positionRound) %&gt;% 
  summarise(CTRmean = sum(clicks) / sum(impressions),
            n = n(),
            click.sum = sum(clicks),
            impressions.sum = sum(impressions),
            sd = sd(ctr),
            E = poisson.test(click.sum)$conf.int[2] / poisson.test(impressions.sum)$conf.int[1],
            lower = CTRmean - E/2,
            upper = CTRmean + E/2) %&gt;% ungroup()

## add % increase to position 1
## could also include other positions
click_curve &lt;- click_curve %&gt;% 
  mutate(CTR1 = CTRmean[1] / CTRmean,
         CTR1.upper = upper[1] / upper,
         CTR1.lower = lower[1] / lower)


</code></pre>

<p><img src="/images/ctr-curve.png" alt="ctr-curve-seo" /></p>

<p>These CTR rates are then used to predict how much more traffic/revenue etc. a keyword could get if they moved up to position 1.</p>

<h3 id="how-valuable-is-a-keyword-if-position-1">How valuable is a keyword if position 1?</h3>

<p>Once happy with the click curve, we now apply it to the original data, and work out estimates on SEO revenue for each keyword if they were at position 1.</p>

<p>I trust results more if they have had more than 10 clicks, and the accuracy estimate figure is within 10 of 0. I would play around with this limits a little yourself to get something you can work with.</p>

<pre><code class="language-r">library(dplyr)
## combine with data

predict_click &lt;- tidy_data1 %&gt;% 
  mutate(positionRound = round(position)) %&gt;%
  left_join(click_curve, by=c(positionRound = &quot;positionRound&quot;)) %&gt;%
  mutate(revenueEst1 = revenueEst * CTR1,
         transEst1 = transactionsEst * CTR1,
         clickEst1 = clicks * CTR1,
         sessionsEst1 = sessionEst * CTR1,
         revenueEst1.lower = revenueEst * CTR1.lower,
         revenueEst1.upper = revenueEst * CTR1.upper,
         revenueEst1.change = revenueEst1 - revenueEst)

estimates &lt;- predict_click %&gt;% 
  select(landingPagePath, query, clicks, impressions, 
         ctr, position, serp, revenueEst, revenueEst1, 
         revenueEst1.change, revenueEst1.lower, revenueEst1.upper, 
         accuracyEst) %&gt;%
  arrange(desc(revenueEst1)) %&gt;% 
  dplyr::filter(abs(accuracyEst) &lt; 10, 
                revenueEst1.change &gt; 0, 
                clicks &gt; 10)

</code></pre>

<p><code>estimates</code> now in this example holds 226 rows sorted in order or how much revenue they are to make if position #1 in Google. This is from an original keyword list of 21437, which is at least a way to narrow down to important keywords.</p>

<h2 id="plotting-the-data">Plotting the data</h2>

<p>All that remains to to present the data: limiting the keywords to the top 30 lets you present like below.</p>

<p>The bars show the range of the estimate, as you can see its quite wide but lets you be more realistic in your expectations.</p>

<p>The number in the middle of the bar is the current position, with the revenue at the x axis and keyword on the y.</p>

<p><img src="/images/see-potential.png" alt="seo-forecast-estimate" /></p>

<h3 id="ggplot2-code">ggplot2 code</h3>

<p>To create the plots in this post, please see the ggplot2 code below.  Feel free to modify for your own needs:</p>

<pre><code class="language-r">library(ggplot2)

## CTR per position
ctr_plot &lt;- ggplot(tidy_data, aes(x = position, 
                                  y = ctr
                                  ))
ctr_plot &lt;- ctr_plot + theme_minimal()
ctr_plot &lt;- ctr_plot + coord_cartesian(xlim = c(1,30), 
                                       ylim = c(0, 0.5))
ctr_plot &lt;- ctr_plot + geom_point(aes(alpha = log(clicks),
                                      color = serp, 
                                      size = clicks))
ctr_plot &lt;- ctr_plot + geom_smooth(aes(weight = clicks), 
                                   size = 0.2)
ctr_plot + scale_y_continuous(labels = scales::percent)
ctr_plot

hh &lt;- ggplot(click_curve, aes(positionRound, CTRmean)) 
hh &lt;- hh + theme_minimal()
hh &lt;- hh + geom_line(linetype = 2) + coord_cartesian(xlim = c(1, 30), 
                                                     ylim = c(0,0.5))
hh &lt;- hh + geom_ribbon(aes(positionRound, ymin = lower, ymax = upper), 
                       alpha = 0.2, 
                       fill = &quot;orange&quot;)
hh &lt;- hh + scale_y_continuous(labels = scales::percent)
hh &lt;- hh + geom_point() 
hh &lt;- hh + geom_label(aes(label = scales::percent(CTRmean)))
hh


est_plot &lt;- ggplot(estimates[1:30,], 
                   aes(reorder(query, revenueEst1), 
                       revenueEst1, 
                       ymax = revenueEst1.upper, 
                       ymin =  revenueEst1.lower))
est_plot &lt;- est_plot + theme_minimal() + coord_flip()

est_plot &lt;- est_plot + geom_crossbar(aes(fill = cut(accuracyEst, 
                                                    3, 
                                                    labels = c(&quot;Good&quot;,
                                                               &quot;Ok&quot;,
                                                               &quot;Poor&quot;))
                                                               ), 
                                     alpha = 0.7, 
                                     show.legend = FALSE)
                                     
est_plot &lt;- est_plot + scale_x_discrete(name = &quot;Query&quot;)
est_plot &lt;- est_plot + scale_y_continuous(name = &quot;Estimated SEO Revenue Increase for Google #1&quot;, 
                                          labels = scales::dollar_format(prefix = &quot;Â£&quot;))
est_plot &lt;- est_plot + geom_label(aes(label = round(position)), 
                                  hjust = &quot;center&quot;)
est_plot &lt;- est_plot + ggtitle(&quot;SEO Potential Revenue (Current position)&quot;)
est_plot

</code></pre>

        </div>
        <footer class="article-footer">
    <a data-url="https://code.markedmondson.me/search-console-google-analytics-r-keyword-research/" data-id="93f9d7348db275c87b006e1e24780658" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
    </a>
    
    <a href="https://code.markedmondson.me/search-console-google-analytics-r-keyword-research/#disqus_thread" class="article-comment-link">
        Comments
    </a>
    

    <script>
    (function ($) {
        
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
    </script>
</footer>

    </div>

    
<nav id="article-nav">
    
    <a href="https://code.markedmondson.me/setting-up-scheduled-R-scripts-for-an-analytics-team/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Older
      </strong>
      <div class="article-nav-title">Scheduling R scripts for a team using RStudio Server, Docker, Github and Google Compute Engine</div>
    </a>
    

    
    <a href="https://code.markedmondson.me/anti-sampling-google-analytics-api/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Newer
      </strong>
      <div class="article-nav-title">Efficient anti-sampling with the Google Analytics Reporting API</div>
    </a>
    
</nav>


</article>


<section id="comments">
    <div id="disqus_thread">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "markedmondson" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</section>


    </section>

   	
    	<aside id="sidebar">
    
<div class="widget-wrap">
    <h3 class="widget-title">
        Recents
    </h3>
    <div class="widget">
        <ul id="recent-post">
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/edmondlytica/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/edmonlytica-shiny1.png)" alt="SEO keyword research using searchConsoleR and googleAnalyticsR" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/edmondlytica/" class="title">Creating your own cookieless analytics tool with GTM Server Side, Cloud Run, BigQuery and Shiny</a></p>
                    <p class="item-date">
                        <time datetime="2021-03-21 09:29:50 &#43;0100 CET" itemprop="datePublished">2021-03-21</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/data-privacy-gtm/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/hawks-and-doves.jpg)" alt="SEO keyword research using searchConsoleR and googleAnalyticsR" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/data-privacy-gtm/" class="title">Data Privacy Engineering with Google Tag Manager Server Side and Consent Mode</a></p>
                    <p class="item-date">
                        <time datetime="2020-11-27 09:29:50 &#43;0100 CET" itemprop="datePublished">2020-11-27</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/gtm-serverside-webhooks/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/gtm-serverside-events.png)" alt="SEO keyword research using searchConsoleR and googleAnalyticsR" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/gtm-serverside-webhooks/" class="title">Using Google Tag Manager Server Side to Trigger Webhook Events</a></p>
                    <p class="item-date">
                        <time datetime="2020-09-04 12:50:50 &#43;0100 &#43;0100" itemprop="datePublished">2020-09-04</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/gtm-serverside-cloudrun/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/princess-gtm.png)" alt="SEO keyword research using searchConsoleR and googleAnalyticsR" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/gtm-serverside-cloudrun/" class="title">Google Tag Manager Server Side on Cloud Run - Pros and Cons</a></p>
                    <p class="item-date">
                        <time datetime="2020-08-21 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-08-21</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/shiny-cloudrun/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/shiny-clouds.jpg)" alt="SEO keyword research using searchConsoleR and googleAnalyticsR" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/shiny-cloudrun/" class="title">Shiny on Google Cloud Run - Scale-to-Zero R Web Apps</a></p>
                    <p class="item-date">
                        <time datetime="2020-08-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">2020-08-01</time>
                    </p>
                </div>
            </li>
            
        </ul>
    </div>
</div>


    
<div class="widget-wrap">
    <h3 class="widget-title">
        Donate
    </h3>
    <div class="widget">
       	<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marked" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
       	<iframe src="https://github.com/sponsors/MarkEdmondson1234/button" title="Sponsor MarkEdmondson1234" height="35" width="116" style="border: 0;"></iframe>
    </div>
</div>


    





    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tags
    </h3>
    <div class="widget">
        <ul class="category-list">
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/R">
                    R
                </a>
                <span class="category-list-count">21</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/big-query">
                    big-query
                </a>
                <span class="category-list-count">6</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/blogging">
                    blogging
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/cloud-functions">
                    cloud-functions
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/cloud-run">
                    cloud-run
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/docker">
                    docker
                </a>
                <span class="category-list-count">9</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/firebase">
                    firebase
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-analytics">
                    google-analytics
                </a>
                <span class="category-list-count">11</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-app-engine">
                    google-app-engine
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-auth">
                    google-auth
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-cloud-storage">
                    google-cloud-storage
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-compute-engine">
                    google-compute-engine
                </a>
                <span class="category-list-count">7</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-language">
                    google-language
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-tag-manager">
                    google-tag-manager
                </a>
                <span class="category-list-count">7</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/python">
                    python
                </a>
                <span class="category-list-count">5</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/rstudio-server">
                    rstudio-server
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/search-console">
                    search-console
                </a>
                <span class="category-list-count">3</span>
            </li>
            
        </ul>
    </div>
</div>




    


    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

    
	</div>
</div>

<footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021
      Powered by <a href="//gohugo.io">Hugo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>.
    </div>
  </div>
</footer>


<script src="https://code.markedmondson.me/fancybox/jquery.fancybox.pack.js"></script>
<script src="https://code.markedmondson.me/js/script.js"></script>
<script src="https://code.markedmondson.me/js/highlight.pack.js"></script>


<script>hljs.initHighlightingOnLoad();</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




</body>
</html>