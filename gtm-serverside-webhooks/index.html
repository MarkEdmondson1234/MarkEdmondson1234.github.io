<!DOCTYPE html>
<html lang="en-GB">
<head>
    <title>Using Google Tag Manager Server Side to Trigger Webhook Events &middot; Mark Edmondson</title>
    <meta name="generator" content="Hugo 0.55.5" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Mark Edmondson">
    
      <meta name="description" content="How to configure Google Tag Manager Server Side so it can send webhooks to services upon certain events ">
    
    
    <link rel="canonical" href="https://code.markedmondson.me/gtm-serverside-webhooks/"/>
    <link rel="icon" href="https://code.markedmondson.me/favicon.ico">
    <link rel="apple-touch-icon" href="https://code.markedmondson.me/apple-touch-icon.png"/>
    <link rel="stylesheet" href="https://code.markedmondson.me/css/style.css">
    <link rel="stylesheet" href="https://code.markedmondson.me/css/github.css" rel="stylesheet" id="theme-stylesheet">
    <link rel="stylesheet" href="https://code.markedmondson.me/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.markedmondson.me/fancybox/jquery.fancybox.css">
    
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta property="og:title" content="Using Google Tag Manager Server Side to Trigger Webhook Events" />
<meta property="og:description" content="How to configure Google Tag Manager Server Side so it can send webhooks to services upon certain events " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://code.markedmondson.me/gtm-serverside-webhooks/" />
<meta property="article:published_time" content="2020-09-04T12:50:50&#43;01:00"/>
<meta property="article:modified_time" content="2020-09-04T12:50:50&#43;01:00"/>

    
    
<meta itemprop="name" content="Using Google Tag Manager Server Side to Trigger Webhook Events">
<meta itemprop="description" content="How to configure Google Tag Manager Server Side so it can send webhooks to services upon certain events ">


<meta itemprop="datePublished" content="2020-09-04T12:50:50&#43;01:00" />
<meta itemprop="dateModified" content="2020-09-04T12:50:50&#43;01:00" />
<meta itemprop="wordCount" content="1444">



<meta itemprop="keywords" content="google-tag-manager,cloud-functions," />

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using Google Tag Manager Server Side to Trigger Webhook Events"/>
<meta name="twitter:description" content="How to configure Google Tag Manager Server Side so it can send webhooks to services upon certain events "/>
<meta name="twitter:site" content="@HoloMarkeD"/>

    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://gtm2.markedmondson.me/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WFFMBH');</script>



    <script src="https://code.markedmondson.me/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
<div class="container">


<div id="container">
	<header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="https://code.markedmondson.me/" id="logo">
          
          <i class="logo" style="background-image: url('https://code.markedmondson.me/images/greenhand.png')"></i>
          
          <span class="site-title">Mark Edmondson</span>
      </a>
      <nav id="main-nav">
          
          
          <a class="main-nav-link" href="https://code.markedmondson.me/">Home</a>
          
          
          
          
          
          

          
          <a class="main-nav-link" href="/r-packages/">My R Packages</a>
          

          
          
          
          
          <a class="main-nav-link" href="http://www.markedmondson.me/posts/">Non-code blog</a>
          
          
          
          <a class="main-nav-link" href="https://www.markedmondson.me/static/presentations/">Past Presentations</a>
          
          
      </nav>
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://code.markedmondson.me/images/gde_avatar.jpg"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
              <input type="search" name="q" class="search-form-input" placeholder="Search">
              <button type="submit" class="search-form-submit">
              </button>
              <input type="hidden" name="sitesearch" value="https://code.markedmondson.me/" />
         </form>
        </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tbody>
          <tr>
          
          
          <td><a class="main-nav-link" href="https://code.markedmondson.me/">Home</a></td>
          
          
          
          
          
          

          
          <td><a class="main-nav-link" href="/r-packages/">My R Packages</a></td>
          

          
          
          
          
          <td><a class="main-nav-link" href="http://www.markedmondson.me/posts/">Non-code blog</a></td>
          
          
          
          <td><a class="main-nav-link" href="https://www.markedmondson.me/static/presentations/">Past Presentations</a></td>
          
          
          <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
          <input type="search" name="q" class="search-form-input" placeholder="Search">
          <input type="hidden" name="sitesearch" value="https://code.markedmondson.me/" />
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</header>

   	
   	<div class="outer">
   	
    	<aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      
      <img id="avatar" src="https://code.markedmondson.me/images/gde_avatar.jpg">
      
      <h2 id="name">Mark Edmondson</h2>
      <h3 id="title">Coding in digital analytics</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Copenhagen, Denmark</span>
      
          <a id="follow" href="https://github.com/MarkEdmondson1234">
              Follow
          </a>
      
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        32
        <span>Posts</span>
      </div>
      <div class="article-info-block">
        
          18
        
        <span>
            Tags
        </span>
      </div>
    </div>
    <div class="profile-block social-links">
      <table>
        <tr>
          
<td><a href="//github.com/MarkEdmondson1234" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>























<td><a href="//youtube.com/MarkEdmondsonAtHome" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>















<td><a href="//linkedin.com/in/markpeteredmondson" target="_blank" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td>















<td><a href="//twitter.com/HoloMarkeD" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>


          <td><a href="https://code.markedmondson.me/index.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></td>
        </tr>
      </table>
    </div>
  </div>
</aside>

    

    <section id="main">
    
    <article id="page-undefined" class="article article-type-page" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
            <img src="https://code.markedmondson.me/banners/gtm-serverside-events.png" class="article-banner">
        

        <header class="article-header">
    <a href="https://code.markedmondson.me/gtm-serverside-webhooks/">
    <h1 class="article-title" itemprop="name">
        Using Google Tag Manager Server Side to Trigger Webhook Events
    </h1>
    </a>
    <div class="article-meta">

        
        <div class="article-date">
            <i class="fa fa-calendar"></i>
            <time datetime="2020-09-04 12:50:50 &#43;0100 &#43;0100" itemprop="datePublished">2020-09-04</time>
            &middot;
            1444
            words
            &middot;
            7
            minute read
        </div>
        
        

        
            
            
            <div class="article-category">
                <i class="fa fa-tags"></i>
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/google-tag-manager">google-tag-manager</a>
                &middot;
                
                
                <a class="article-category-link" href="https://code.markedmondson.me/tags/cloud-functions">cloud-functions</a>
                
                
            </div>
            
        
    </div>
</header>

        <div class="article-entry" itemprop="articleBody">
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>When GTM Server Side was announced the use cases for it were not so compelling for me at first.</p>
<p>Sure, extra security and potential speed ups were nice to have, but it wasn’t really necessary for a lot of websites, given the cost. However, now we have had a chance to play with it and can see its integration with the rest of the Google Cloud Platform, new use cases are coming up which are very compelling, especially if the <a href="https://code.markedmondson.me/gtm-serverside-cloudrun/">GTM Server Side costs can be driven down via Cloud Run deployments - see last post</a>.</p>
<p>One of those use cases is triggering event flows from GTM Server Side. This has always been possible via your server, but the ease of setting it up as detailed below opens up a host of opportunities, much like when GTM itself first came out and democratised publishing of tags.</p>
<p>The idea behind using GTM Server Side events is that because its running in your own server, you have access to a lot more configuration including the server logs. Via these, you can surface your dataLayer or other tracking events within <a href="https://cloud.google.com/logging/docs">Cloud Logging</a> - and from there this allows you to use the Cloud Logging features to set up <a href="https://cloud.google.com/logging/docs/routing/overview">Pub/Sub triggers</a>.</p>
<p>This is a technique I picked up from <a href="https://code.markedmondson.me/bigquery-ga360-exports-cloud-functions/">BigQuery logging of GA360 exports - being able to use event logging to process the often late exports rather than using a schedule</a>.</p>
<p>Those Pub/Sub triggers can be used to trigger anything you like - in my example they set off a Cloud Function to send a message to Slack. An example video is shown below of it in action on this blog:</p>
<p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube-nocookie.com/embed/YJYFmxsd38M" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>
<p>The above is done via GTM Server Side, Cloud Logging to a Pub/Sub topic, which triggers a Cloud Function that calls a Slack webhook.</p>
<div id="how-to-do-it" class="section level2">
<h2>How to do it</h2>
<p>I’ll walk through how this proof of concept was set-up, so you can hopefully see how accessible it is. Naturally this is just a POC, your own applications can build on the idea.</p>
<div id="gtm-server-side-setup" class="section level3">
<h3>GTM Server Side Setup</h3>
<p>Within your GTM Server Side Client configuration, you can use the <a href="https://developers.google.com/tag-manager/serverside/api#logtoconsole">logToConsole</a> API which will then send it to the Cloud Logging output.</p>
<p>This ‘Hello World’ example will log the ip address of the requester:</p>
<pre class="node"><code>const logToConsole = require(&#39;logToConsole&#39;);
const getRemoteAddress = require(&#39;getRemoteAddress&#39;);

logToConsole(&#39;triggerIp:&#39;, getRemoteAddress());</code></pre>
<p>In real-life you will probably want to react to more interesting events, such as those in the Google Analytics requests:</p>
<pre class="node"><code>const logToConsole = require(&#39;logToConsole&#39;);
const getRemoteAddress = require(&#39;getRemoteAddress&#39;);
const isRequestMpv1 = require(&#39;isRequestMpv1&#39;);
const extractEventsFromMpv1 = require(&#39;extractEventsFromMpv1&#39;);

// Check if request is Measurement Protocol
if (isRequestMpv1()) {

  let test = false;
  const events = extractEventsFromMpv1();
  events.forEach((event, i) =&gt; {
  
    // if event is a page_view
    if(event.event_name === &quot;page_view&quot;){
      // log some interesting stuff for the trigger
      logToConsole(&#39;triggerIp:&#39;, getRemoteAddress(), 
                   &#39; page:&#39;, event.page_location,
                  &#39; referrer:&#39;, event.page_referrer);
      // for the tests
      test = true;
    }
  });
  
  return test;
  
}</code></pre>
<p>Here is an example of the events from the <code>extractEventsFromMpv1()</code> API:</p>
<pre class="js"><code>[{&quot;x-ga-protocol_version&quot;:&quot;1&quot;,
  &quot;x-ga-system_properties&quot;:{&quot;v&quot;:&quot;j85&quot;,&quot;u&quot;:&quot;SACAAEABAAAAAC~&quot;,&quot;gid&quot;:&quot;12345678.1599216410&quot;,&quot;r&quot;:&quot;1&quot;},
  &quot;x-ga-page_id&quot;:1377079516,
  &quot;x-ga-request_count&quot;:1,
  &quot;page_location&quot;:&quot;https://code.markedmondson.me/r-at-scale-on-google-cloud-platform/&quot;,
  &quot;page_referrer&quot;:&quot;https://www.google.com/&quot;,&quot;language&quot;:&quot;en-gb&quot;,&quot;page_encoding&quot;:&quot;UTF-8&quot;,
  &quot;page_title&quot;:&quot;R at scale on the Google Cloud Platform · Mark Edmondson&quot;,
  &quot;x-ga-mp1-sd&quot;:&quot;24-bit&quot;,
  &quot;screen_resolution&quot;:&quot;1280x800&quot;,
  &quot;x-ga-mp1-vp&quot;:&quot;1264x666&quot;,
  &quot;x-ga-mp1-je&quot;:&quot;0&quot;,
  &quot;x-ga-mp1-jid&quot;:&quot;920318383&quot;,
  &quot;x-ga-mp1-gjid&quot;:&quot;277342247&quot;,
  &quot;client_id&quot;:&quot;12345678.1599216410&quot;,
  &quot;x-ga-measurement_id&quot;:&quot;UA-12345-2&quot;,
  &quot;x-ga-gtm_version&quot;:&quot;2wg8q1XXXX&quot;,
  &quot;x-ga-mp1-z&quot;:&quot;1831891234&quot;,
  &quot;event_name&quot;:&quot;page_view&quot;}]</code></pre>
<p>You can put this data as a mock for a Code test:</p>
<pre class="js"><code>const mockData = [{&quot;x-ga-protocol_version&quot;:&quot;1&quot;,
  &quot;x-ga-system_properties&quot;:{&quot;v&quot;:&quot;j85&quot;,&quot;u&quot;:&quot;SACAAEABAAAAAC~&quot;,&quot;gid&quot;:&quot;12345678.1599216410&quot;,&quot;r&quot;:&quot;1&quot;},
  &quot;x-ga-page_id&quot;:1377079516,
  &quot;x-ga-request_count&quot;:1,
  &quot;page_location&quot;:&quot;https://code.markedmondson.me/r-at-scale-on-google-cloud-platform/&quot;,
  &quot;page_referrer&quot;:&quot;https://www.google.com/&quot;,&quot;language&quot;:&quot;en-gb&quot;,&quot;page_encoding&quot;:&quot;UTF-8&quot;,
  &quot;page_title&quot;:&quot;R at scale on the Google Cloud Platform · Mark Edmondson&quot;,
  &quot;x-ga-mp1-sd&quot;:&quot;24-bit&quot;,
  &quot;screen_resolution&quot;:&quot;1280x800&quot;,
  &quot;x-ga-mp1-vp&quot;:&quot;1264x666&quot;,
  &quot;x-ga-mp1-je&quot;:&quot;0&quot;,
  &quot;x-ga-mp1-jid&quot;:&quot;920318383&quot;,
  &quot;x-ga-mp1-gjid&quot;:&quot;277342247&quot;,
  &quot;client_id&quot;:&quot;12345678.1599216410&quot;,
  &quot;x-ga-measurement_id&quot;:&quot;UA-12345-2&quot;,
  &quot;x-ga-gtm_version&quot;:&quot;2wg8q1XXXX&quot;,
  &quot;x-ga-mp1-z&quot;:&quot;1831891234&quot;,
  &quot;event_name&quot;:&quot;page_view&quot;}];

mock(&#39;isRequestMpv1&#39;, () =&gt; true);
mock(&#39;extractEventsFromMpv1&#39;, () =&gt; mockData);
// Call runCode to run the template&#39;s code.
let result = runCode();
assertThat(result).isTrue();</code></pre>
<p><em>Thanks Simo with help for above</em></p>
<p>You can also make a fancier client that takes fields so the user can decide what to log via the data.fields.</p>
<p>Make sure to turn on the necessary permissions for the GTM Client. For Cloud Logging, this should be on “Always Log” and not just “Debug”.</p>
<p><img src="/images/gtm-client-logging.png" /></p>
<p>Once you have published the Client associated with the Client Template, you should start to see the info in your <a href="https://console.cloud.google.com/logs/viewer">Cloud Logging</a> within the same project.</p>
</div>
<div id="setup-cloud-logging" class="section level3">
<h3>Setup Cloud Logging</h3>
<p>Where these logs are depends on how you deployed your container - in my case this was within Cloud Run, but it is more likely to be in the App Engine logs if you’ve deployed in the usual manner.</p>
<p>You should see them like below:</p>
<p><img src="/images/gtm-cloud-logging.png" />
Once populating, expand out one of them from the log and mouse over the relevant entry and select “Show matching entries”:</p>
<p><img src="/images/gtm-show-matching.png" /></p>
<p>This will populate an advanced filter at the top. This filter is where you define what log entries will trigger the Pub/Sub and subsequent actions via the “Create Sink” button at the top.</p>
<p>For the example above the filter was:</p>
<pre><code>resource.type=&quot;cloud_run_revision&quot;
resource.labels.service_name=&quot;server-side&quot;
textPayload=&quot;triggerIp: 12.34.56.78  page: https://code.markedmondson.me/gtm-serverside-cloudrun/  referrer: undefined&quot;</code></pre>
<p>You may want to relax it a bit, for instance a regex filter that will trigger whatever the page or referrer is. For this you can use the <code>=~</code> operator and put in regex - the below will alter the trigger for only those entries that contain my ip address:</p>
<pre><code>resource.type=&quot;cloud_run_revision&quot;
resource.labels.service_name=&quot;server-side&quot;
textPayload=~&quot;triggerIp: 12.34.56.78&quot;</code></pre>
<p><em>Your resource.type and resource.labels.service_name will differ from mine depending on your deployment - if you have used “Show matching entries” button though it will be populated with the correct data</em></p>
<p>Now “Create Sink” at the top and configure to a Pub/Sub topic. You can use an existing or create a new one in the wizard - this is the same as <a href="https://code.markedmondson.me/bigquery-ga360-exports-cloud-functions/">the BigQuery post details</a>:</p>
<p><img src="/images/ga360_logging_filter.png" /></p>
<p>Once your Pub/Sub topic is setup it will transmit for every new log entry. What processes the Pub/Sub topic is up to you, but for this demo I chose Cloud Functions which processes the data and sends it to my Slack channel.</p>
</div>
<div id="setup-cloud-function" class="section level3">
<h3>Setup Cloud Function</h3>
<p>The Cloud Function I set-up within the Web UI.</p>
<p>The trigger I set to the Pub/Sub topic just created.</p>
<p>I’m using Slack as an example, but you would modify the below for your own application. <a href="https://api.slack.com/tutorials/slack-apps-hello-world">See the Slack tutorials on how to set up its webhooks</a> for your Slack channel. I chose it as its a super simple API for this kind of thing.</p>
<p>I used Cloud Functions web editor to enter this Python code:</p>
<pre class="py"><code>import requests
import base64
import logging

def website_alert(event, context):

    // replace with your Slack webhook
    url = &quot;https://hooks.slack.com/services/CODEHERE/BLAHBLAH/ASECRETCODE&quot;

    pubsub_message = base64.b64decode(event[&#39;data&#39;]).decode(&#39;utf-8&#39;)

    logging.info(pubsub_message)
    
    payload = &#39;{&quot;text&quot;:&quot;You just visited the website&quot;}&#39;

    headers = {
        &#39;Content-Type&#39;: &#39;application/json&#39;
    }

    response = requests.request(&quot;POST&quot;, url, headers=headers, data=payload)

    print(response.text.encode(&#39;utf8&#39;))</code></pre>
<p>Replace the Slack webhook for your own then publish the code and visit the website - you should get the Slack popup. Check the Cloud Function logs if its not working.</p>
</div>
</div>
<div id="improvements-and-where-to-go-from-here" class="section level2">
<h2>Improvements and where to go from here</h2>
<p>Its a nice demo but its not something you could use seriously every day yet. Obviously you will want to select the filters and application you want to send data to, and configure the events you are sending in.</p>
<p>Other than that, you may wish to not use Cloud Logging and Pub/Sub but rather HTTP requests directly from the GTM Client - it has a <a href="https://developers.google.com/tag-manager/serverside/api#sendhttpget"><code>sendHttpGet()</code></a> and <a href="https://developers.google.com/tag-manager/serverside/api#sendhttprequest"><code>sendHttpRequest()</code></a> for this purpose. But I wonder if they will be as reliable as Pub/Sub, which guarantees at least once delivery.</p>
<p>Another potential serious issue is that logging costs money, and in fact recently there are already <a href="https://developers.google.com/tag-manager/serverside/script-user-guide#disable_app_engine_request_logging_optional">updates to turn off some of the GTM logging</a> to reduce your cloud costs. This can still be done just selectively, so you can preserve your Cloud Logging for the above purposes if necessary.</p>
<p>The whole idea can be traced back to <a href="https://twitter.com/silviueftimie">Silviu Eftimie</a> on the GTM Server Side forums, who was wondering if the new <a href="https://www.youtube.com/watch?reload=9&amp;v=Uz8G8fTwwXs">Google Cloud Workflows</a>, a service that allows real-time processing of data. This looks very exciting and opens the door to complete and complex data-flows reacting to the events sent.</p>
<p><a href="https://firebase.google.com/products">Firebase has several APIs</a> that would really nicely fit in here too. Instead of Slack messages, a call to <a href="https://firebase.google.com/products/cloud-messaging">Firebase Cloud Messaging</a> for example would allow you to distribute alerts to mobile devices and/or web at scale, or tailored to individuals (a web developer for example if a server failure event is sent?) - other services include Remote Config (change app content?) and Predictions.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>GTM Server Side has made me post <a href="https://code.markedmondson.me/gtm-serverside-cloudrun/">two blog posts</a> in a week, a new record. Its that game changing for new use cases which I hope to be working on in the next couple of years. It really shows how the Cloud can empower digital analytics, and how its firmly planted in its future, one which I am looking forward to seeing. If you have any other ideas on how this new paradigm will help generate more use cases, I’d be very interested in hearing what you are doing!</p>
</div>

        </div>
        <footer class="article-footer">
    <a data-url="https://code.markedmondson.me/gtm-serverside-webhooks/" data-id="0a09a9f3291d0079d8d6443a8e2773d3" class="article-share-link">
        <i class="fa fa-share"></i>
        Share
    </a>
    

    <script>
    (function ($) {
        
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
    </script>
</footer>

    </div>

    
<nav id="article-nav">
    
    <a href="https://code.markedmondson.me/gtm-serverside-cloudrun/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Older
      </strong>
      <div class="article-nav-title">Google Tag Manager Server Side on Cloud Run - Pros and Cons</div>
    </a>
    

    
    <a href="https://code.markedmondson.me/data-privacy-gtm/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">
          Newer
      </strong>
      <div class="article-nav-title">Data Privacy Engineering with Google Tag Manager Server Side and Consent Mode</div>
    </a>
    
</nav>


</article>


<section id="comments">
    <div id="utterances_thread">
        <script src="https://utteranc.es/client.js"
    repo="MarkEdmondson1234/markedmondson.me-hugo"
    issue-term="pathname"
    label="comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
    </div>
</section>


    </section>

   	
    	<aside id="sidebar">
    
<div class="widget-wrap">
    <h3 class="widget-title">
        Recents
    </h3>
    <div class="widget">
        <ul id="recent-post">
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/sending-ga4-events-pubsub/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/sun-outburst.jpg)" alt="Using Google Tag Manager Server Side to Trigger Webhook Events" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/sending-ga4-events-pubsub/" class="title">Activating GA4 events with GTM Server-Side and Pub/Sub for Fun and Profit</a></p>
                    <p class="item-date">
                        <time datetime="2022-01-04 00:00:00 &#43;0000 UTC" itemprop="datePublished">2022-01-04</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/writing-a-book/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/proto-book.png)" alt="Using Google Tag Manager Server Side to Trigger Webhook Events" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/writing-a-book/" class="title">Why and How I&#39;m writing a GA4 book called &#39;Learning Google Analytics&#39; for O&#39;Reilly</a></p>
                    <p class="item-date">
                        <time datetime="2021-10-23 11:04:50 &#43;0100 &#43;0100" itemprop="datePublished">2021-10-23</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/googleanalyticsr-100-release/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/GA4-090.png)" alt="Using Google Tag Manager Server Side to Trigger Webhook Events" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/googleanalyticsr-100-release/" class="title">googleAnalyticsR v1.0.0 - GA4 API, Automatic Shiny Dashboarding, Improved UI</a></p>
                    <p class="item-date">
                        <time datetime="2021-04-17 09:29:50 &#43;0100 &#43;0100" itemprop="datePublished">2021-04-17</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/edmondlytica/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/edmonlytica-shiny1.png)" alt="Using Google Tag Manager Server Side to Trigger Webhook Events" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/edmondlytica/" class="title">Creating your own cookieless analytics tool with GTM Server Side, Cloud Run, BigQuery and Shiny</a></p>
                    <p class="item-date">
                        <time datetime="2021-03-21 09:29:50 &#43;0100 CET" itemprop="datePublished">2021-03-21</time>
                    </p>
                </div>
            </li>
            
            <li>
                <div class="item-thumbnail">
                    <a href="https://code.markedmondson.me/data-privacy-gtm/" class="thumbnail">
                    
                        <span style="background-image:url(https://code.markedmondson.me/banners/hawks-and-doves.jpg)" alt="Using Google Tag Manager Server Side to Trigger Webhook Events" class="thumbnail-image"></span>
                    
                    </a>
                </div>
                <div class="item-inner">
                    
                    <p class="item-title"><a href="https://code.markedmondson.me/data-privacy-gtm/" class="title">Data Privacy Engineering with Google Tag Manager Server Side and Consent Mode</a></p>
                    <p class="item-date">
                        <time datetime="2020-11-27 09:29:50 &#43;0100 CET" itemprop="datePublished">2020-11-27</time>
                    </p>
                </div>
            </li>
            
        </ul>
    </div>
</div>


    
<div class="widget-wrap">
    <h3 class="widget-title">
        Donate
    </h3>
    <div class="widget">
       	<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="marked" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
       	<iframe src="https://github.com/sponsors/MarkEdmondson1234/button" title="Sponsor MarkEdmondson1234" height="35" width="116" style="border: 0;"></iframe>
    </div>
</div>


    
<div class="widget-wrap">
    <h3 class="widget-title">
        Get your GA4 history
    </h3>
    <script>
      function submitDL(value){
        dataLayer.push({'event':'ga4_email','ga4_email':value});
        document.getElementById('email').value = 'Submitted! See inbox'
        var button = document.getElementById('email_button');
        button.disabled = true;
      }
        
    </script>
    <div>
        <input type="email" name="email"  id="email"
          required 
          minlength="8"
          placeholder="you@email.com">
        <button id='email_button'
          onclick="javascript:submitDL(document.getElementById('email').value);"
         >Send</button>
    </div>
</div>


    





    


<div class="widget-wrap">
    <h3 class="widget-title">
        Tags
    </h3>
    <div class="widget">
        <ul class="category-list">
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/r">
                    R
                </a>
                <span class="category-list-count">22</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/big-query">
                    big-query
                </a>
                <span class="category-list-count">7</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/blogging">
                    blogging
                </a>
                <span class="category-list-count">3</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/cloud-functions">
                    cloud-functions
                </a>
                <span class="category-list-count">5</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/cloud-run">
                    cloud-run
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/docker">
                    docker
                </a>
                <span class="category-list-count">9</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/firebase">
                    firebase
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-analytics">
                    google-analytics
                </a>
                <span class="category-list-count">13</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-app-engine">
                    google-app-engine
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-auth">
                    google-auth
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-cloud-storage">
                    google-cloud-storage
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-compute-engine">
                    google-compute-engine
                </a>
                <span class="category-list-count">7</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-language">
                    google-language
                </a>
                <span class="category-list-count">2</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/google-tag-manager">
                    google-tag-manager
                </a>
                <span class="category-list-count">8</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/pubsub">
                    pubsub
                </a>
                <span class="category-list-count">1</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/python">
                    python
                </a>
                <span class="category-list-count">6</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/rstudio-server">
                    rstudio-server
                </a>
                <span class="category-list-count">4</span>
            </li>
            
            <li class="category-list-item">
                
                <a class="category-list-link" href="https://code.markedmondson.me/tags/search-console">
                    search-console
                </a>
                <span class="category-list-count">3</span>
            </li>
            
        </ul>
    </div>
</div>




    


    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

    
	</div>
</div>

<footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022
      Powered by <a href="//gohugo.io">Hugo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>.
    </div>
  </div>
</footer>


<script src="https://code.markedmondson.me/fancybox/jquery.fancybox.pack.js"></script>
<script src="https://code.markedmondson.me/js/script.js"></script>
<script src="https://code.markedmondson.me/js/highlight.pack.js"></script>


<script>hljs.initHighlightingOnLoad();</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>




</body>
</html>